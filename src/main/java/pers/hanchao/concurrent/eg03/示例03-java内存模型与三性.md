# 示例03-java内存模型与三性

## 1.Java内存模型

JMM定义了程序变量的访问规则，即定义了程序的执行顺序。

JMM规定：
- 所有的变量都是存于主内存（Main Memory，慢）当中，每个线程都有自己的工作内存（Work Memory，块）。
- 线程对变量的所有操作都必须在工作内存进行。
- 线程对变量操作前，需要去主内存获取变量，并在工作内存中形成副本。
- 线程对变量操作完成之后，需要将变量副本更新到主内存的变量中。
- 每个线程不能访问其他线程的工作内存。

JMM存在一致性问题和指令重排问题。

## 2.Java并发的三个特性

如需包装并发安全，则必须保证线程的原子性、可见性、有序性。

### 2.1.原子性

- JMM支持的原子操作：基本的赋值和获取变量
- Java中，保证批量变量操作原子性的措施：使用synchronized关键字、使用Lock接口以及使用Atomic类型

### 2.2.可见性

- 可见性:在工作内存中，对一个变量修改时，能够保证修改的值即被更新到主内存中，从而被其他线程看见。
- 普通的共享变量不能保证可见性，应为在工作区间修改完成后，什么时候更新到内存中，是不确定的。
- Java中能够保证变量可见性的有：volatile关键字、synchronized代码块、Lock接口以及Atomic类型。
- volatile关键字以及Atomic类型适合作为状态标识变量。
- synchronized代码块、Lock接口不适合作为状态标识变量，所以没有举例。但是参考原子性，可以推断出，二者必定保持了可见性。